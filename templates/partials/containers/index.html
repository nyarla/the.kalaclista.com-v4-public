<!--
  {{ $global := index . 0 }}
  {{ $section := index . 1 }}
  {{ $isIndex := index . 2 }}
  {{ $page := $global.Page }}
  {{ $meta := partial `data/meta.fn` (slice $global $section) }}
-->
<html amp lang="ja">
  <head>
    <meta charset="utf-8" />

    <!-- Metadata -->
    <link rel="canonical" href="{{ $meta.url }}" />

    <title>{{ $meta.combinedTitle }}</title>
    <meta name="description" content="{{ $meta.summary }}" />
    <meta property="og:title" content="{{ $meta.title }}" />
    <meta property="og:site_name" content="{{ $meta.siteTitle }}" />
    <meta property="og:image" content="{{ absURL `/assets/avatar.png` }}" />
    <meta property="og:url" content="{{ $meta.url }}" />

    <meta property="og:type" content="{{ $meta.type }}" />
    <meta property="og:description" content="{{ $meta.summary }}" />

    <!-- {{ if eq $meta.type "article" }} -->
    <meta property="og:article:published_time" content="{{ $meta.datetime }}" />
    <meta property="og:article:modified_time" content="{{ $meta.lastmod }}" />
    <meta property="og:article:author" content="OKAMURA Naoki aka nyarla" />
    <meta
      property="og:article:section"
      content="{{ (index $global.Site.Params.menus $section).name }}"
    />
    <!-- {{ end }} -->

    <meta property="og:profile:first_name" content="Naoki" />
    <meta property="og:profile:last_name" content="OKAMURA" />
    <meta property="og:profile:username" content="kalaclista" />

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@kalaclista" />
    <meta name="twitter:title" content="{{ $meta.title }}" />
    <meta name="twitter:description" content="{{ $meta.summary }}" />
    <meta name="twitter:image" content="{{ absURL `/assets/avatar.png` }}" />

    <!-- prettier-ignore -->
    <script type="application/ld+json">{{ partial `data/jsonld.fn` (slice $global $section) | jsonify | safeJS }}</script>

    <!--
      {{ $prefix := `` }}
      {{ if and (ne $section `home`) (ne $page.Type `home`) }}
        {{ $prefix = $section }}
      {{ end }}
    -->
    <link
      rel="alternate"
      type="application/rss+xml"
      href="{{ absURL (printf `%s/index.xml` $prefix) }}"
      title="{{ printf `%sの RSS フィード` $meta.siteTitle }}"
    />
    <link
      rel="alternate"
      type="application/atom+xml"
      href="{{ absURL (printf `%s/atom.xml` $prefix) }}"
      title="{{ printf `%sの Atom フィード` $meta.siteTitle }}"
    />
    <link
      rel="alternate"
      type="application/feed+json"
      href="{{ absURL (printf `%s/jsonfeed.json` $prefix) }}"
      title="{{ printf `%sの JSON フィード` $meta.siteTitle }}"
    />

    <link rel="manifest" href="{{ absURL `/manifest.webmanifest` }}" />
    <link rel="icon" href="{{ absURL `/favicon.ico` }}" />
    <link rel="icon" href="{{ absURL `/icon.svg` }}" type="image/svg+xml" />
    <link rel="apple-touch-icon" href="{{ absURL `/apple-touch-icon.png` }}" />

    <!-- Preload -->
    <meta http-equiv="x-dns-prefetch-control" content="on" />
    <link rel="preconnect dns-prefetch" href="//cdn.ampproject.org" />
    <!-- {{ if hugo.IsProduction }} -->
    <link rel="preconnect dns-prefetch" href="//googleads.g.doubleclick.net" />

    <link rel="preconnect dns-prefetch" href="//www.google-analytics.com" />
    <link rel="preconnect dns-prefetch" href="//stats.g.doubleclick.net" />
    <link rel="preconnect dns-prefetch" href="//www.google.com" />
    <link rel="preconnect dns-prefetch" href="//www.google.co.jp" />
    <link
      rel="preconnect dns-prefetch"
      href="//pagead2.googlesyndication.com"
    />

    <link rel="preconnect dns-prefetch" href="//tpc.googlesyndication.com" />
    <link rel="preconnect dns-prefetch" href="//accounts.google.com" />

    <link rel="preconnect dns-prefetch" href="//www.googletagmanager.com" />
    <!-- {{ end }} -->

    <link rel="preload" as="script" href="https://cdn.ampproject.org/v0.js" />
    <!-- {{ if hugo.IsProduction }} -->
    <link
      rel="preload"
      as="script"
      href="https://cdn.ampproject.org/v0/amp-ad-0.1.js"
    />
    <link
      rel="preload"
      as="script"
      href="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"
    />
    <!-- {{ end }} -->

    <!-- Custom Elements -->
    <script async src="https://cdn.ampproject.org/v0.js"></script>
    <!-- {{ if hugo.IsProduction }} -->
    <script
      async
      custom-element="amp-ad"
      src="https://cdn.ampproject.org/v0/amp-ad-0.1.js"
    ></script>
    <script
      async
      custom-element="amp-analytics"
      src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"
    ></script>
    <!-- {{ end }} -->

    <!-- Stylesheet -->
    <meta
      name="viewport"
      content="width=device-width,minimum-scale=1,initial-scale=1"
    />
    <!-- prettier-ignore -->
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style>
    <!-- prettier-ignore -->
    <noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>

    <!-- {{ $base := (resources.Get "scss/base.scss" | resources.ToCSS (dict)).Content }} -->
    <style amp-custom>
      {{ $base | safeCSS }}
    </style>
  </head>
  <body data-amp-auto-lightbox-disable>
    <!-- prettier-ignore -->
    {{ partialCached `widgets/menu.html.html` (slice $global $section) $section }}
    <!-- {{ if $isIndex }} -->
    <!-- {{ if eq $section `home` }} -->
    {{ partialCached `pages/home.html.html` (slice $global $section) $section }}
    <!-- {{ else }} -->
    <!-- prettier-ignore -->
    {{ partialCached `pages/entries.html.html` (slice $global $section) $section }}
    <!-- {{ end }} -->
    <!-- {{ else }} -->
    {{ partialCached `widgets/content.html.html` $global $page.Content }}
    <!-- {{ end }} -->
    <!-- prettier-ignore -->
    {{ partialCached `widgets/info.html.html` (slice $global $section) $section }}
    <amp-analytics type="gtag" data-credentials="include">
      <script type="application/json">
        {
          "vars": {
            "gtag_id": "UA-158600592-1",
            "config": {
              "UA-158600592-1": { "groups": "default" }
            }
          }
        }
      </script>
    </amp-analytics>
  </body>
</html>
